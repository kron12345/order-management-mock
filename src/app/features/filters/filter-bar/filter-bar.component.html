<div class="filters">
  <mat-form-field appearance="outline">
    <mat-label>Suchen</mat-label>
    <input
      matInput
      placeholder="Name oder ID"
      [ngModel]="search()"
      (ngModelChange)="onSearchChange($event)"
    />
  </mat-form-field>

  <mat-form-field appearance="outline">
    <mat-label>Fahrplanjahr</mat-label>
    <mat-select
      [value]="store.filters().timetableYearLabel"
      (valueChange)="onTimetableYearChange($event)"
    >
      <mat-option value="all">Alle Fahrplanjahre</mat-option>
      @for (year of store.timetableYearOptions(); track year) {
        <mat-option [value]="year">{{ year }}</mat-option>
      }
    </mat-select>
  </mat-form-field>

  <mat-form-field appearance="outline">
    <mat-label>Tag</mat-label>
    <input
      matInput
      placeholder="z. B. S-Bahn"
      [value]="tag() === 'all' ? '' : tag()"
      (input)="onTagInput($event)"
    />
  </mat-form-field>

  <mat-form-field appearance="outline">
    <mat-label>Zugnummer</mat-label>
    <input
      matInput
      placeholder="z. B. 4711"
      [ngModel]="trainNumber()"
      (ngModelChange)="onTrainNumberChange($event)"
    />
  </mat-form-field>

  <mat-form-field appearance="outline">
    <mat-label>Zeitraum</mat-label>
    <mat-select
      [value]="store.filters().timeRange"
      (valueChange)="onTimeRangeChange($event)"
    >
      @for (option of timeOptions; track option.value) {
        <mat-option [value]="option.value">{{ option.label }}</mat-option>
      }
    </mat-select>
  </mat-form-field>

  <mat-form-field appearance="outline">
    <mat-label>Fahrplanphase</mat-label>
    <mat-select
      [value]="store.filters().trainStatus"
      (valueChange)="onTrainStatusChange($event)"
    >
      @for (option of trainStatusOptions; track option.value) {
        <mat-option [value]="option.value">{{ option.label }}</mat-option>
      }
    </mat-select>
  </mat-form-field>

  <mat-form-field appearance="outline">
    <mat-label>Geschäftsstatus</mat-label>
    <mat-select
      [value]="store.filters().businessStatus"
      (valueChange)="onBusinessStatusChange($event)"
    >
      @for (option of businessStatusOptions; track option.value) {
        <mat-option [value]="option.value">{{ option.label }}</mat-option>
      }
    </mat-select>
  </mat-form-field>

  <span class="spacer"></span>

  <button mat-stroked-button (click)="onReset()">Zurücksetzen</button>
</div>

@if (store.filters().linkedBusinessId) {
  <div class="business-filter-banner">
    <mat-icon>work_history</mat-icon>
    <div class="banner-text">
      <strong>Gefiltert nach Geschäft</strong>
      <span>{{ activeBusinessFilter()?.title || store.filters().linkedBusinessId }}</span>
    </div>
    <button mat-stroked-button color="primary" (click)="clearBusinessFilter()">
      Filter entfernen
    </button>
  </div>
}
