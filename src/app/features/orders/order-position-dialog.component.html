<h2 mat-dialog-title>Auftragsposition hinzufügen</h2>

<mat-dialog-content>
  <div class="mode-toggle">
    <mat-button-toggle-group [formControl]="modeControl" appearance="legacy">
      <mat-button-toggle value="service">Leistung</mat-button-toggle>
      <mat-button-toggle value="plan">Fahrplan</mat-button-toggle>
    </mat-button-toggle-group>
  </div>

  <div class="section" *ngIf="mode() === 'service'">
    <form [formGroup]="serviceForm" class="form">
      <mat-form-field appearance="outline">
        <mat-label>Positionsname</mat-label>
        <input matInput formControlName="name" placeholder="Zug 1 / 08:00" />
        @if (serviceForm.controls.name.invalid && serviceForm.controls.name.touched) {
          <mat-error>Pflichtfeld.</mat-error>
        }
      </mat-form-field>

      <div class="grid">
        <mat-form-field appearance="outline">
          <mat-label>Typ</mat-label>
          <mat-select formControlName="type">
            <mat-option value="TTT">TTT</mat-option>
            <mat-option value="Fahrzeugsegment">Fahrzeugsegment</mat-option>
            <mat-option value="Sonstiges">Sonstiges</mat-option>
          </mat-select>
        </mat-form-field>
        <mat-form-field appearance="outline">
          <mat-label>Leistungstyp</mat-label>
          <input matInput formControlName="serviceType" placeholder="z. B. Umlauf" />
        </mat-form-field>
      </div>

      <div class="grid">
        <mat-form-field appearance="outline">
          <mat-label>Von</mat-label>
          <input matInput formControlName="fromLocation" />
        </mat-form-field>
        <mat-form-field appearance="outline">
          <mat-label>Nach</mat-label>
          <input matInput formControlName="toLocation" />
        </mat-form-field>
      </div>

      <div class="grid">
        <mat-form-field appearance="outline">
          <mat-label>Start</mat-label>
          <input matInput type="datetime-local" formControlName="start" />
        </mat-form-field>
        <mat-form-field appearance="outline">
          <mat-label>Ende</mat-label>
          <input matInput type="datetime-local" formControlName="end" />
        </mat-form-field>
      </div>

      <div class="grid">
        <mat-form-field appearance="outline">
          <mat-label>Verkehrsperiode</mat-label>
          <mat-select formControlName="trafficPeriodId">
            @for (period of trafficPeriods(); track period.id) {
              <mat-option [value]="period.id">{{ period.name }}</mat-option>
            }
          </mat-select>
        </mat-form-field>
        <mat-form-field appearance="outline">
          <mat-label>Verantwortlich</mat-label>
          <input matInput formControlName="responsible" />
        </mat-form-field>
      </div>

      <mat-form-field appearance="outline">
        <mat-label>Bemerkung</mat-label>
        <input matInput formControlName="deviation" placeholder="z. B. +3 min" />
      </mat-form-field>
    </form>
  </div>

  <div class="section" *ngIf="mode() === 'plan'">
    <form [formGroup]="planForm" class="form">
      <mat-form-field appearance="outline">
        <mat-label>Vorlage</mat-label>
        <mat-select formControlName="templateId">
          @for (template of templates(); track template.id) {
            <mat-option [value]="template.id">{{ template.title }}</mat-option>
          }
        </mat-select>
      </mat-form-field>

      <mat-form-field appearance="outline">
        <mat-label>Verkehrsperiode</mat-label>
        <mat-select formControlName="trafficPeriodId">
          @for (period of trafficPeriods(); track period.id) {
            <mat-option [value]="period.id">{{ period.name }}</mat-option>
          }
        </mat-select>
      </mat-form-field>

      <div class="grid">
        <mat-form-field appearance="outline">
          <mat-label>Erste Abfahrt</mat-label>
          <input matInput type="time" formControlName="startTime" />
        </mat-form-field>
        <mat-form-field appearance="outline">
          <mat-label>Takt (Minuten)</mat-label>
          <input matInput type="number" formControlName="intervalMinutes" min="1" />
        </mat-form-field>
        <mat-form-field appearance="outline">
          <mat-label>Anzahl Züge</mat-label>
          <input matInput type="number" formControlName="count" min="1" />
        </mat-form-field>
      </div>

      <div class="grid">
        <mat-form-field appearance="outline">
          <mat-label>Namenspräfix</mat-label>
          <input matInput formControlName="namePrefix" placeholder="z. B. S3 Basel" />
        </mat-form-field>
        <mat-form-field appearance="outline">
          <mat-label>Verantwortlich</mat-label>
          <input matInput formControlName="responsible" />
        </mat-form-field>
      </div>
    </form>
  </div>

  @if (errorMessage()) {
    <p class="error">{{ errorMessage() }}</p>
  }
</mat-dialog-content>

<mat-dialog-actions align="end">
  <button mat-button (click)="cancel()">Abbrechen</button>
  <button mat-flat-button color="primary" (click)="save()">Speichern</button>
</mat-dialog-actions>
