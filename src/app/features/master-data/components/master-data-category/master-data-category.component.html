<div class="md-category">
  <div class="md-category__list">
    <header class="md-category__list-header">
      <h3>{{ config.entityLabel }} ({{ items().length }})</h3>
      <button mat-stroked-button color="primary" type="button" (click)="handleCreate()">
        <mat-icon fontIcon="add"></mat-icon>
        Neu anlegen
      </button>
    </header>

    <table
      mat-table
      [dataSource]="items()"
      class="md-category__table"
      [attr.aria-label]="config.entityLabel + ' Tabelle'"
    >
      <ng-container *ngFor="let column of config.columns" [matColumnDef]="column.key">
        <th mat-header-cell *matHeaderCellDef>{{ column.label }}</th>
        <td
          mat-cell
          *matCellDef="let row"
          (click)="handleSelect(row.id)"
          [class.is-active]="row.id === selectedId()"
        >
          {{ displayCell(row, column.key) }}
        </td>
      </ng-container>

      <ng-container matColumnDef="actions">
        <th mat-header-cell *matHeaderCellDef></th>
        <td mat-cell *matCellDef="let row">
          <button
            mat-icon-button
            type="button"
            (click)="handleSelect(row.id); $event.stopPropagation()"
            [attr.aria-label]="
              'Bearbeiten ' +
              displayCell(row, config.columns.length ? config.columns[0].key : 'id')
            "
          >
            <mat-icon fontIcon="edit"></mat-icon>
          </button>
        </td>
      </ng-container>

      <tr mat-header-row *matHeaderRowDef="displayedColumns()"></tr>
      <tr
        mat-row
        *matRowDef="let row; columns: displayedColumns()"
        (click)="handleSelect(row.id)"
        [class.is-active]="row.id === selectedId()"
      ></tr>
    </table>
  </div>

  <div class="md-category__detail" *ngIf="selectedItem() as selection">
    <header class="md-category__detail-header">
      <h3>{{ config.entityLabel }} bearbeiten</h3>
      <span class="md-category__detail-meta">ID {{ selection.id }}</span>
    </header>

    <form [formGroup]="form" (ngSubmit)="handleSave()" class="md-category__form">
      <input type="hidden" formControlName="id" />

      <div class="md-category__form-grid">
        <ng-container *ngFor="let field of config.fields">
          <mat-form-field appearance="outline">
            <mat-label>{{ field.label }}</mat-label>

            <ng-container [ngSwitch]="field.type">
              <input
                *ngSwitchCase="'text'"
                matInput
                [formControlName]="field.key"
                [placeholder]="field.placeholder ?? ''"
              />

              <textarea
                *ngSwitchCase="'textarea'"
                matInput
                [formControlName]="field.key"
                [placeholder]="field.placeholder ?? ''"
                rows="3"
              ></textarea>

              <input
                *ngSwitchCase="'number'"
                matInput
                type="number"
                [formControlName]="field.key"
                [placeholder]="field.placeholder ?? ''"
              />

              <mat-select
                *ngSwitchCase="'select'"
                [formControlName]="field.key"
                [placeholder]="field.placeholder ?? ''"
              >
                <mat-option *ngFor="let option of fieldOptions(field)" [value]="option.value">
                  {{ option.label }}
                </mat-option>
              </mat-select>

              <mat-select
                *ngSwitchCase="'multiselect'"
                [formControlName]="field.key"
                [placeholder]="field.placeholder ?? ''"
                multiple
              >
                <mat-option *ngFor="let option of fieldOptions(field)" [value]="option.value">
                  {{ option.label }}
                </mat-option>
              </mat-select>
            </ng-container>

            <mat-hint *ngIf="field.hint">{{ field.hint }}</mat-hint>
          </mat-form-field>
        </ng-container>
      </div>

      <div class="md-category__form-actions">
        <button mat-stroked-button type="button" (click)="handleSelect(selection.id)">
          Ã„nderungen verwerfen
        </button>
        <button mat-flat-button color="primary" type="submit">Speichern</button>
      </div>
    </form>
  </div>
</div>
