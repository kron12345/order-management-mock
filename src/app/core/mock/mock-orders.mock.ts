import { Order } from '../models/order.model';

const TODAY = new Date();

const isoDate = (offsetDays: number): string => {
  const date = new Date(TODAY);
  date.setDate(date.getDate() + offsetDays);
  return date.toISOString().slice(0, 10);
};

const isoDateTime = (offsetDays: number, time: string): string => {
  return `${isoDate(offsetDays)}T${time}`;
};

const validityRange = (startOffset: number, lengthDays: number) => ({
  startDate: isoDate(startOffset),
  endDate: isoDate(startOffset + Math.max(lengthDays, 1)),
});

const timetableYearLabel = (monthOffset = 0): string => {
  const base = new Date(TODAY);
  base.setMonth(base.getMonth() + monthOffset);
  const year = base.getMonth() >= 6 ? base.getFullYear() : base.getFullYear() - 1;
  const next = (year + 1).toString();
  return `${year}/${next.slice(-2)}`;
};

export const MOCK_ORDERS: Order[] = [
  {
    id: 'ORD-2030-001',
    name: 'ICE Sprinter Berlin – Köln/Bremen',
    customerId: 'cust-db-001',
    customer: 'DB Fernverkehr',
    tags: ['ICE', 'Flügelzug', 'TTT'],
    comment: 'Flügelzugkonzept inkl. Splitting in Hannover. Varianten und Aufgaben laufen direkt gegen den Fahrplanmanager.',
    timetableYearLabel: '2029/30',
    items: [
      {
        id: 'ORD-2030-001-OP-001',
        name: 'ICE 1501 Baseline',
        type: 'Fahrplan',
        start: '2030-04-01T06:05:00',
        end: '2030-04-01T10:12:00',
        responsible: 'FV Planung Ost',
        fromLocation: 'Berlin Hbf (tief)',
        toLocation: 'Köln/Bremen',
        trafficPeriodId: 'TPER-2030-ICE',
        linkedTemplateId: 'TPL-ICE-FLGL',
        linkedTrainPlanId: 'TP-2030-ICE-0001',
        linkedBusinessIds: ['BUS-ICE-01'],
        validity: [{ startDate: '2030-04-01', endDate: '2030-07-31' }],
        versionPath: [1],
        childItemIds: ['ORD-2030-001-OP-002'],
        generatedTimetableRefId: 'TT-2030-ICE-001A',
        timetablePhase: 'path_request',
        timetableYearLabel: '2029/30',
        originalTimetable: {
          refTrainId: 'TT-2030-ICE-001A',
          title: 'ICE 1501 Berlin Hbf → Köln Hbf',
          trainNumber: 'ICE 1501',
          calendar: {
            validFrom: '2030-04-01',
            validTo: '2030-10-31',
            daysBitmap: '1111100',
          },
          stops: [
            { sequence: 1, locationName: 'Berlin Hbf (tief)', departureTime: '06:05' },
            { sequence: 2, locationName: 'Wolfsburg Hbf', arrivalTime: '07:18', departureTime: '07:20' },
            { sequence: 3, locationName: 'Hannover Hbf', arrivalTime: '07:58', departureTime: '08:10' },
            { sequence: 4, locationName: 'Köln Hbf', arrivalTime: '10:12' },
            { sequence: 5, locationName: 'Bremen Hbf', arrivalTime: '09:58' },
          ],
        },
      },
      {
        id: 'ORD-2030-001-OP-002',
        name: 'ICE 1501A Köln-Teil · Version 1.1',
        type: 'Fahrplan',
        parentItemId: 'ORD-2030-001-OP-001',
        start: '2030-08-01T06:05:00',
        end: '2030-08-01T10:05:00',
        responsible: 'FV Planung West',
        deviation: 'TTT-Angebot mit geänderter Splittingzeit',
        fromLocation: 'Berlin Hbf (tief)',
        toLocation: 'Köln Hbf',
        trafficPeriodId: 'TPER-2030-ICE',
        linkedTemplateId: 'TPL-ICE-FLGL',
        linkedTrainPlanId: 'TP-2030-ICE-0002',
        linkedBusinessIds: ['BUS-ICE-01'],
        validity: [{ startDate: '2030-08-01', endDate: '2031-03-31' }],
        versionPath: [1, 1],
        generatedTimetableRefId: 'TT-2030-ICE-001B',
        timetablePhase: 'offer',
        timetableYearLabel: '2029/30',
        originalTimetable: {
          refTrainId: 'TT-2030-ICE-001A',
          title: 'ICE 1501 Ursprung',
          trainNumber: 'ICE 1501',
          calendar: {
            validFrom: '2030-04-01',
            validTo: '2030-10-31',
            daysBitmap: '1111100',
          },
          stops: [
            { sequence: 1, locationName: 'Berlin Hbf (tief)', departureTime: '06:05' },
            { sequence: 2, locationName: 'Hannover Hbf', arrivalTime: '07:58', departureTime: '08:10' },
            { sequence: 3, locationName: 'Köln Hbf', arrivalTime: '10:12' },
          ],
        },
      },
      {
        id: 'ORD-2030-001-OP-003',
        name: 'Betriebsbegleitung Köln',
        type: 'Leistung',
        serviceType: 'Betriebsbegleitung',
        fromLocation: 'Köln Hbf',
        toLocation: 'Hannover Hbf',
        start: '2030-04-01T05:30:00',
        end: '2030-04-01T12:00:00',
        responsible: 'InfraGO Leitstelle',
        validity: [{ startDate: '2030-04-01', endDate: '2030-05-31' }],
        versionPath: [1],
        trafficPeriodId: 'TPER-2030-SERVICE-KOELN',
        timetableYearLabel: '2029/30',
      },
    ],
  },
  {
    id: 'ORD-2030-002',
    name: 'RE Zürich – Bern 2030',
    customerId: 'cust-sbb-001',
    customer: 'SBB Personenverkehr',
    tags: ['RegionalExpress', 'RVK'],
    timetableYearLabel: '2029/30',
    items: [
      {
        id: 'ORD-2030-002-OP-001',
        name: 'RE Zürich – Bern Grundtakt',
        type: 'Fahrplan',
        start: '2030-01-01T07:05:00',
        end: '2030-01-01T08:28:00',
        responsible: 'SBB Fahrplan ZH',
        fromLocation: 'Zürich HB',
        toLocation: 'Bern',
        trafficPeriodId: 'TPER-2030-REGIO',
        linkedTemplateId: 'TPL-REGIO-ZH-BE',
        linkedTrainPlanId: 'TP-2030-REG-0001',
        linkedBusinessIds: ['BUS-RE-01'],
        validity: [{ startDate: '2030-01-01', endDate: '2030-12-31' }],
        versionPath: [1],
        generatedTimetableRefId: 'TT-2030-RE-0101',
        timetablePhase: 'operational',
        timetableYearLabel: '2029/30',
        originalTimetable: {
          refTrainId: 'TT-2030-RE-0101',
          title: 'RE Zürich HB → Bern',
          trainNumber: 'RE 520',
          calendar: {
            validFrom: '2030-01-01',
            validTo: '2030-12-31',
            daysBitmap: '1111111',
          },
          stops: [
            { sequence: 1, locationName: 'Zürich HB', departureTime: '07:05' },
            { sequence: 2, locationName: 'Aarau', arrivalTime: '07:36', departureTime: '07:37' },
            { sequence: 3, locationName: 'Olten', arrivalTime: '07:55', departureTime: '07:57' },
            { sequence: 4, locationName: 'Bern', arrivalTime: '08:28' },
          ],
        },
      },
      {
        id: 'ORD-2030-002-OP-002',
        name: 'RE Zürich – Bern Ersatzlage Bauphase',
        type: 'Fahrplan',
        parentItemId: 'ORD-2030-002-OP-001',
        start: '2030-05-15T07:05:00',
        end: '2030-05-15T08:40:00',
        responsible: 'SBB Fahrplan ZH',
        deviation: 'Verlängerte Fahrzeit wegen Bern Ost Gleisbau',
        fromLocation: 'Zürich HB',
        toLocation: 'Bern',
        trafficPeriodId: 'TPER-2030-REGIO',
        linkedTemplateId: 'TPL-REGIO-ZH-BE',
        validity: [{ startDate: '2030-05-15', endDate: '2030-06-15' }],
        versionPath: [1, 1],
        generatedTimetableRefId: 'TT-2030-RE-0102',
        timetablePhase: 'contract',
        timetableYearLabel: '2029/30',
        originalTimetable: {
          refTrainId: 'TT-2030-RE-0101',
          title: 'RE Zürich HB → Bern (Original)',
          trainNumber: 'RE 520',
          calendar: {
            validFrom: '2030-01-01',
            validTo: '2030-12-31',
            daysBitmap: '1111111',
          },
          stops: [
            { sequence: 1, locationName: 'Zürich HB', departureTime: '07:05' },
            { sequence: 2, locationName: 'Bern', arrivalTime: '08:28' },
          ],
        },
      },
    ],
  },
  {
    id: 'ORD-2030-003',
    name: 'Güterkorridor Rotterdam – Basel',
    customerId: 'cust-cargon-001',
    customer: 'CargoNet Europe',
    tags: ['Güterverkehr', 'Nacht'],
    timetableYearLabel: '2029/30',
    items: [
      {
        id: 'ORD-2030-003-OP-001',
        name: 'DGS Rotterdam – Basel Nachtkorridor',
        type: 'Fahrplan',
        start: '2030-03-01T22:15:00',
        end: '2030-03-02T06:05:00',
        responsible: 'CargoNet Dispatch',
        fromLocation: 'Rotterdam Maasvlakte',
        toLocation: 'Basel RB',
        trafficPeriodId: 'TPER-2030-CARGO',
        linkedTemplateId: 'TPL-CARGO-RB',
        linkedTrainPlanId: 'TP-2030-CARGO-0001',
        linkedBusinessIds: ['BUS-CARGO-01'],
        validity: [{ startDate: '2030-03-01', endDate: '2030-12-31' }],
        versionPath: [1],
        generatedTimetableRefId: 'TT-2030-CARGO-7001',
        timetablePhase: 'bedarf',
        timetableYearLabel: '2029/30',
        originalTimetable: {
          refTrainId: 'TT-2030-CARGO-7001',
          title: 'DGS Rotterdam → Basel',
          trainNumber: 'DGS 94701',
          calendar: {
            validFrom: '2030-03-01',
            validTo: '2030-12-31',
            daysBitmap: '1111100',
          },
          stops: [
            { sequence: 1, locationName: 'Rotterdam Maasvlakte', departureTime: '22:15' },
            { sequence: 2, locationName: 'Köln Eifeltor', arrivalTime: '02:05', departureTime: '02:25' },
            { sequence: 3, locationName: 'Basel RB', arrivalTime: '06:05' },
          ],
        },
      },
      {
        id: 'ORD-2030-003-OP-002',
        name: 'Baulogistik Ersatzfenster Basel',
        type: 'Leistung',
        serviceType: 'Baulogistik',
        fromLocation: 'Basel RB',
        toLocation: 'Basel Bad Rbf',
        start: '2030-04-01T20:00:00',
        end: '2030-04-02T04:00:00',
        responsible: 'InfraGO Nord',
        validity: [{ startDate: '2030-04-01', endDate: '2030-05-31' }],
        versionPath: [1],
        trafficPeriodId: 'TPER-2030-BAULOG-BSL',
        timetableYearLabel: '2029/30',
      },
    ],
  },
  {
    id: 'ORD-TTR-DEMO',
    name: 'Demo · Automations- und Phasen-Playground',
    customer: 'Demo EVU Süd',
    tags: ['#demo', '#automation', '#ttr'],
    comment:
      'Diese Aufträge decken alle TTR-Phasen ab und dienen als Spielwiese für Automationsregeln.',
    timetableYearLabel: timetableYearLabel(6),
    items: [
      {
        id: 'ORD-TTR-DEMO-OP-001',
        name: 'Kapazitätsworkshop Metropolregion',
        type: 'Leistung',
        serviceType: 'Workshop',
        fromLocation: 'Berlin',
        toLocation: 'Berlin',
        start: isoDateTime(320, '09:00:00'),
        end: isoDateTime(320, '11:30:00'),
        responsible: 'Planung Hauptstadt',
        tags: ['#capacity', '#vorlauf'],
        validity: [validityRange(320, 1)],
        timetablePhase: 'bedarf',
        deviation: 'Strategische Abstimmung mit Infra.',
      },
      {
        id: 'ORD-TTR-DEMO-OP-002',
        name: 'Jahresbestellung Sprinter Nord',
        type: 'Fahrplan',
        start: isoDateTime(230, '05:40:00'),
        end: isoDateTime(230, '09:05:00'),
        responsible: 'Fernverkehr Nord',
        tags: ['#annual', '#sprinter'],
        validity: [validityRange(230, 90)],
        timetablePhase: 'path_request',
        linkedTemplateId: 'TPL-DEMO-ANNUAL',
      },
      {
        id: 'ORD-TTR-DEMO-OP-003',
        name: 'Final Offer Prüflauf',
        type: 'Fahrplan',
        start: isoDateTime(150, '06:15:00'),
        end: isoDateTime(150, '08:55:00'),
        responsible: 'Fernverkehr Mitte',
        tags: ['#offer', '#entscheid'],
        validity: [validityRange(150, 45)],
        timetablePhase: 'offer',
        deviation: 'TTT-Angebot mit +3 min Ankunft.',
      },
      {
        id: 'ORD-TTR-DEMO-OP-004',
        name: 'Rolling Planning Verstärker',
        type: 'Fahrplan',
        start: isoDateTime(40, '07:10:00'),
        end: isoDateTime(40, '10:02:00'),
        responsible: 'Operations Süd',
        tags: ['#rolling', '#verstärker'],
        validity: [validityRange(40, 14)],
        timetablePhase: 'contract',
        deviation: 'Zusätzliche Wochenendlage.',
      },
      {
        id: 'ORD-TTR-DEMO-OP-005',
        name: 'Short-Term Zusatzfahrt',
        type: 'Fahrplan',
        start: isoDateTime(12, '04:55:00'),
        end: isoDateTime(12, '07:12:00'),
        responsible: 'Dispo West',
        tags: ['#str', '#kurzfrist'],
        validity: [validityRange(12, 7)],
        timetablePhase: 'operational',
        deviation: 'Auslöser: Baustelle Rheinbrücke.',
      },
      {
        id: 'ORD-TTR-DEMO-OP-006',
        name: 'Ad-hoc Ersatzfahrt',
        type: 'Fahrplan',
        start: isoDateTime(2, '18:10:00'),
        end: isoDateTime(2, '21:05:00'),
        responsible: 'Leitstelle Köln',
        tags: ['#adhoc', '#störung'],
        validity: [validityRange(2, 1)],
        timetablePhase: 'operational',
        deviation: 'Fahrzeugtausch wegen Defekt.',
      },
      {
        id: 'ORD-TTR-DEMO-OP-007',
        name: 'Baukoordinations-Taskforce',
        type: 'Leistung',
        serviceType: 'Baukoordination',
        fromLocation: 'Stuttgart',
        toLocation: 'Stuttgart',
        start: isoDateTime(-10, '08:00:00'),
        end: isoDateTime(-10, '12:00:00'),
        responsible: 'Infra Südwest',
        tags: ['#operational', '#nachlauf'],
        validity: [validityRange(-10, 5)],
        timetablePhase: 'archived',
      },
    ],
  },
];
